<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://boris.quiq-api.com/app/chat-ui/index.js" charset="UTF-8"></script>
</head>

<body>
    <script>
          var chat = Quiq({
            pageConfigurationId: 'default'
          });
    dataLayer = [
    {
        "event": "OneTrustLoaded",
        "OnetrustActiveGroups": ",C0001,C0003,C0002,C0007,C0004,C0005,C0008,C0009,C0010,",
        "gtm.uniqueEventId": 3
    },
    {
        "event": "OptanonLoaded",
        "OptanonActiveGroups": ",C0001,C0003,C0002,C0007,C0004,C0005,C0008,C0009,C0010,",
        "gtm.uniqueEventId": 22
    },
    {
        "event": "OneTrustGroupsUpdated",
        "OnetrustActiveGroups": ",C0001,C0003,C0002,C0007,C0004,C0005,C0008,C0009,C0010,",
        "gtm.uniqueEventId": 29
    },
    {
        "event": "kameleoon_experiment",
        "campaign_name": "Sofitel : Hotel Price Widget",
        "campaign_id": 329981,
        "variation_name": "Variation 1",
        "variation_id": 1163786,
        "gtm.uniqueEventId": 36
    },
    {
        "event": "experience_impression",
        "exp_variant_string": "KAM-329981-1163786",
        "kam_campaign_name": "Sofitel : Hotel Price Widget",
        "kam_campaign_id": 329981,
        "kam_variation_name": "Variation 1",
        "kam_variation_id": 1163786,
        "gtm.uniqueEventId": 43
    },
    {
        "event": "OneTrustLoaded",
        "OnetrustActiveGroups": ",C0001,C0003,C0002,C0007,C0004,C0005,C0008,C0009,C0010,",
        "gtm.uniqueEventId": 50
    },
    {
        "event": "OptanonLoaded",
        "OptanonActiveGroups": ",C0001,C0003,C0002,C0007,C0004,C0005,C0008,C0009,C0010,",
        "gtm.uniqueEventId": 57
    },
    {
        "gtm.start": 1758042215312,
        "event": "gtm.js",
        "gtm.uniqueEventId": 64
    },
    {
        "event": "gtm.dom",
        "gtm.uniqueEventId": 71
    },
    {
        "event": "gtm.load",
        "gtm.uniqueEventId": 87
    },
    {
        "b2bbookingcontext": "",
        "category": "booking",
        "clienttype": "B2C",
        "countrycurrencycode": "USD",
        "hotelcurrencycode": "AED",
        "hotelbrandcode": "IBS",
        "hotelbrandname": "",
        "hotelcitycode": "V7419",
        "hotelcityname": "Dubai",
        "hotelcode": "9633",
        "hotelcountrycode": "AE",
        "hotelcountryname": "United Arab Emirates",
        "hotelgssrating": "",
        "hotelname": "ibis Styles Dragon Mart Dubai",
        "hoteltripadvisorrating": "",
        "mainstepindicator": 2,
        "offercode": "",
        "pagetype": "",
        "partnerdeduplication": 0,
        "partners_name": "",
        "partners_type": "",
        "roomcode": "",
        "searchcriteriaarrivaldate": "17-09-2025",
        "searchcriteriacitycode": "",
        "searchcriteriacityname": "",
        "searchcriteriacountrycode": "",
        "searchcriteriacountryname": "",
        "searchcriteriadeparturedate": "25-09-2025",
        "searchcriteriadestination": "",
        "searchcriteriahotelratingclass": "",
        "searchcriteriauseb2bcode": false,
        "searchresultsdetails": [],
        "sub_category_level1": "step2rates",
        "sub_category_level2": "",
        "sub_category_level3": "",
        "sub_category_level4": "",
        "transactionId": "",
        "ui_snu": "",
        "virtual_page_path": "",
        "event": "push_dynamic_datas",
        "dynamic_datas_ready": true,
        "language": "en",
        "countrymarket": "us",
        "devicetype": "desktop",
        "currencycode": "EUR",
        "userId": "",
        "brandcontext": "ALL",
        "env": "production",
        "gacid": "",
        "uamerchantid": "AH",
        "uasourceid": "AH",
        "tarsmerchantid": "AH",
        "tarssourceid": "AH",
        "partner_id": "",
        "hmGUID": "",
        "qt_tracking_id": "",
        "advertiser_id": "",
        "trvReference": "",
        "locale": "",
        "refId": "",
        "kayakclickid": "",
        "abProvider": "Default",
        "abCampaign": "Default",
        "abVariant": "Default",
        "abexperiment": "reference",
        "brandname": "",
        "datefieldempty": false,
        "mainstepname": "rates",
        "modification": "",
        "os": "",
        "pagename": "booking::step2rates",
        "resolution": "",
        "userconsent": true,
        "searchcriterianumberadult": 1,
        "searchcriterianumberchildren": 0,
        "searchcriterianumbernights": 8,
        "searchcriterianumberrooms": 1,
        "searchroomcriteria1": {
            "numberadults": 1,
            "numberchildren": 0
        },
        "daysbeforearrival": 0,
        "sitecode": "",
        "loyaltycardtypes": "",
        "searchcriterialoyaltycard": "",
        "hotel_rumava": false,
        "hotel_child_conversion": false,
        "hotel_rates_childpolicy": false,
        "xtor": "",
        "dclid": "",
        "gclid": "",
        "rates_smart_composition": false,
        "rates_context": "rates available",
        "uisnu_activation": "not connected",
        "uistayplus_activation": "not connected",
        "ecommerce": {
            "currencyCode": "EUR",
            "checkout": {
                "actionField": {
                    "step": 1
                },
                "products": [
                    {
                        "id": "9633",
                        "name": "ibis Styles Dragon Mart Dubai",
                        "brand": "IBS"
                    }
                ]
            }
        },
        "uilogged": false,
        "uicity": "",
        "uicountry": "",
        "uiallmember": "not logged",
        "uiloyaltypoints": "",
        "newsletteroptin": false,
        "uiemailsha256": "",
        "user_data": {
            "userId": "",
            "uilogged": false,
            "uicity": "",
            "uicountry": "",
            "uiallmember": "not logged",
            "uiloyaltypoints": "",
            "newsletteroptin": false,
            "clienttype": "B2C",
            "uiemailsha256": "",
            "loyaltycardtypes": "",
            "uisnu_activation": "not connected",
            "uistayplus_activation": "not connected"
        },
        "page_data": {
            "b2bbookingcontext": "",
            "category": "booking",
            "clienttype": "B2C",
            "countrycurrencycode": "USD",
            "hotelcurrencycode": "AED",
            "hotelbrandcode": "IBS",
            "hotelbrandname": "",
            "hotelcitycode": "V7419",
            "hotelcityname": "Dubai",
            "hotelcode": "9633",
            "hotelcountrycode": "AE",
            "hotelcountryname": "United Arab Emirates",
            "hotelgssrating": "",
            "hotelname": "ibis Styles Dragon Mart Dubai",
            "hoteltripadvisorrating": "",
            "mainstepindicator": 2,
            "offercode": "",
            "pagetype": "",
            "partnerdeduplication": 0,
            "partners_name": "",
            "partners_type": "",
            "roomcode": "",
            "searchcriteriaarrivaldate": "17-09-2025",
            "searchcriteriacitycode": "",
            "searchcriteriacityname": "",
            "searchcriteriacountrycode": "",
            "searchcriteriacountryname": "",
            "searchcriteriadeparturedate": "25-09-2025",
            "searchcriteriadestination": "",
            "searchcriteriahotelratingclass": "",
            "searchcriteriauseb2bcode": false,
            "searchresultsdetails": [],
            "sub_category_level1": "step2rates",
            "sub_category_level2": "",
            "sub_category_level3": "",
            "sub_category_level4": "",
            "transactionId": "",
            "ui_snu": "",
            "virtual_page_path": "",
            "event": "push_dynamic_datas",
            "dynamic_datas_ready": true,
            "language": "en",
            "countrymarket": "us",
            "devicetype": "desktop",
            "currencycode": "EUR",
            "userId": "",
            "brandcontext": "ALL",
            "env": "production",
            "gacid": "",
            "uamerchantid": "AH",
            "uasourceid": "AH",
            "tarsmerchantid": "AH",
            "tarssourceid": "AH",
            "partner_id": "",
            "hmGUID": "",
            "qt_tracking_id": "",
            "advertiser_id": "",
            "trvReference": "",
            "locale": "",
            "refId": "",
            "kayakclickid": "",
            "abProvider": "Default",
            "abCampaign": "Default",
            "abVariant": "Default",
            "abexperiment": "reference",
            "brandname": "",
            "datefieldempty": false,
            "mainstepname": "rates",
            "modification": "",
            "os": "",
            "pagename": "booking::step2rates",
            "resolution": "",
            "userconsent": true,
            "searchcriterianumberadult": 1,
            "searchcriterianumberchildren": 0,
            "searchcriterianumbernights": 8,
            "searchcriterianumberrooms": 1,
            "searchroomcriteria1": {
                "numberadults": 1,
                "numberchildren": 0
            },
            "daysbeforearrival": 0,
            "sitecode": "",
            "loyaltycardtypes": "",
            "searchcriterialoyaltycard": "",
            "hotel_rumava": false,
            "hotel_child_conversion": false,
            "hotel_rates_childpolicy": false,
            "xtor": "",
            "dclid": "",
            "gclid": "",
            "rates_smart_composition": false,
            "rates_context": "rates available",
            "uisnu_activation": "not connected",
            "uistayplus_activation": "not connected",
            "ecommerce": {
                "currencyCode": "EUR",
                "checkout": {
                    "actionField": {
                        "step": 1
                    },
                    "products": [
                        {
                            "id": "9633",
                            "name": "ibis Styles Dragon Mart Dubai",
                            "brand": "IBS"
                        }
                    ]
                }
            }
        },
        "eventTimeout": 2000,
        "gtm.uniqueEventId": 96
    },
    {
        "event": "seenaptic",
        "gtm.uniqueEventId": 243
    },
    {
        "event": "pageViewFired",
        "gtm.uniqueEventId": 246
    },
    {
        "gaReady": "yes"
    },
    {
        "event": "GAevent",
        "eventCategory": "booking funnel - rates",
        "eventAction": "filter - cta display",
        "eventLabel": "free cancellation",
        "nonInteractional": false,
        "gtm.uniqueEventId": 438
    },
    {
        "event": "GAevent",
        "eventCategory": "booking funnel - rates",
        "eventAction": "filter - cta display",
        "eventLabel": "breakfast included",
        "nonInteractional": false,
        "gtm.uniqueEventId": 449
    },
    {
        "ecommerce": null
    },
    {
        "event": "begin_checkout",
        "ecommerce": {
            "currency": "EUR",
            "value": null,
            "items": [
                {
                    "item_id": "9633",
                    "item_name": "ibis Styles Dragon Mart Dubai",
                    "item_brand": "IBS",
                    "index": 1
                }
            ]
        },
        "gtm.uniqueEventId": 460
    },
    {
        "event": "coreWebVitals",
        "webVitalsMeasurement": {
            "name": "CLS",
            "id": "v2-1758042215606-5945801860631",
            "value": 5,
            "delta": 5
        },
        "gtm.uniqueEventId": 646
    },
    {
        "event": "coreWebVitals",
        "webVitalsMeasurement": {
            "name": "LCP",
            "id": "v2-1758042215606-5870686641102",
            "value": 352,
            "delta": 352
        },
        "gtm.uniqueEventId": 655
    },
    {
        "event": "GAevent",
        "eventCategory": "popin toctoc",
        "eventAction": "popin display",
        "eventLabel": "popin toctoc",
        "nonInteractional": false,
        "gtm.uniqueEventId": 664
    },
    {
        "event": "gtm.click",
        "gtm.element": {
            "_prevClass": "btn btn--primary expired-session__buttons--refresh",
            "_meaningfulType": null
        },
        "gtm.elementClasses": "btn btn--primary expired-session__buttons--refresh",
        "gtm.elementId": "",
        "gtm.elementTarget": "",
        "gtm.triggers": "84",
        "gtm.elementUrl": "",
        "gtm.uniqueEventId": 675
    },
    {
        "event": "GAevent",
        "eventCategory": "errors",
        "eventAction": "web services",
        "eventLabel": "404 - PUT - Hotel",
        "nonInteractional": false,
        "gtm.uniqueEventId": 684
    },
    {
        "event": "gtm.scrollDepth",
        "gtm.scrollThreshold": 90,
        "gtm.scrollUnits": "percent",
        "gtm.scrollDirection": "vertical",
        "gtm.triggers": "472,476",
        "gtm.uniqueEventId": 695
    }
]
    </script>




    
    <script>
        (function () {
    const pollEveryMS = 1000; // Check every 1 sec
    const maxWaitTimeMS = 20000; // Max wait time before any found fields are submitted to Quiq: 20 seconds

    let hotelName = null;
    let checkInDate = null;
    let checkOutDate = null;
    let numNights = null;
    let numAdults = null;
    let numKids = null;
    let numRooms = null;
    let preferredLanguage = null;
    let timeoutReached = false;

    // Extract language from URL if it follows /booking format
    function extractLanguageFromURL() {
        const url = 'https://all.accor.com/booking/fr/accor/hotel/1413?destination=aeroport-orly-1-2-3-94390-paray-vieille-poste-france&compositions=1&dateIn=2025-10-13&dateOut=2025-10-14&nights=1&hideWDR=false&accessibleRoom=false&basketId=fd0910ad-1746-4312-8181-5ef5fe11d919' //window.location.href;
        const bookingMatch = url.match(/\/booking\/([^\/]+)\/accor\/hotel/i);
        if (bookingMatch && bookingMatch[1]) {
            return bookingMatch[1];
        }
        return null;
    }

    preferredLanguage = extractLanguageFromURL();

    const num = maybe_num => typeof maybe_num === 'number'

    function pollForHotelSearchParams() {
        if (window.chat && window.dataLayer && Array.isArray(window.dataLayer)) {
            for (let i = 0; i < window.dataLayer.length; i++) {
                const dlItem = window.dataLayer[i];

                if (dlItem.hotelname && hotelName !== dlItem.hotelname) {
                    hotelName = dlItem.hotelname;
                }
                if (dlItem.searchcriteriaarrivaldate && checkInDate !== dlItem.searchcriteriaarrivaldate) {
                    checkInDate = dlItem.searchcriteriaarrivaldate;
                }
                if (dlItem.searchcriteriadeparturedate && checkOutDate !== dlItem.searchcriteriadeparturedate) {
                    checkOutDate = dlItem.searchcriteriadeparturedate;
                }
                if (num(dlItem.searchcriterianumbernights) && numNights !== dlItem.searchcriterianumbernights) {
                    numNights = dlItem.searchcriterianumbernights;
                }
                if (num(dlItem.searchcriterianumberadult) && numAdults !== dlItem.searchcriterianumberadult) {
                    numAdults = dlItem.searchcriterianumberadult;
                }
                if (num(dlItem.searchcriterianumberchildren) && numKids !== dlItem.searchcriterianumberchildren) {
                    numKids = dlItem.searchcriterianumberchildren;
                }
                if (num(dlItem.searchcriterianumberrooms) && numRooms !== dlItem.searchcriterianumberrooms) {
                    numRooms = dlItem.searchcriterianumberrooms;
                }
            }

            if ((hotelName && checkInDate && checkOutDate && num(numNights) && num(numAdults) && num(numKids) & num(numRooms)) || timeoutReached) {
                console.log("Sending hotel information to Quiq:", {
                    hotelName,
                    checkInDate,
                    checkOutDate,
                    numNights,
                    numAdults,
                    numKids,
                    numRooms,
                    preferredLanguage
                });

                if (hotelName) {
                    window.chat.setChatRegistrationField('schema.conversation.custom.paiHotelName', hotelName);
                }
                if (checkInDate) {
                    window.chat.setChatRegistrationField('schema.conversation.custom.paiCheckInDate', checkInDate);
                }
                if (checkOutDate) {
                    window.chat.setChatRegistrationField('schema.conversation.custom.paiCheckoutDate', checkOutDate);
                }
                if (num(numNights)) {
                    window.chat.setChatRegistrationField('schema.conversation.custom.paiNumNights', numNights);
                }
                if (num(numAdults)) {
                    window.chat.setChatRegistrationField('schema.conversation.custom.paiNumAdults', numAdults);
                }
                if (num(numKids)) {
                    window.chat.setChatRegistrationField('schema.conversation.custom.paiNumKids', numKids);
                }
                if (num(numRooms)) {
                    window.chat.setChatRegistrationField('schema.conversation.custom.paiNumRooms', numRooms);
                }
                if (preferredLanguage) {
                    console.log('preferredLanguage:', preferredLanguage);
                    window.chat.setChatRegistrationField('schema.conversation.customer.preferredLanguage', preferredLanguage);
                }

                return; // Stop polling
            }
        }

        if (!timeoutReached) setTimeout(pollForHotelSearchParams, pollEveryMS);
    }

    setTimeout(() => {
        timeoutReached = true;
    }, maxWaitTimeMS);

    pollForHotelSearchParams();
})();


    </script>

     quiq test page v1.0.20
</body>
</html>
